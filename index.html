<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zikir - Manevi Tesbihat</title>
  <meta name="description" content="G√ºnl√ºk zikir ve tesbihat uygulamasƒ±" />
  <meta name="theme-color" content="#1a0f0a" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&family=Cinzel+Decorative:wght@400;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
  <style>
    :root {
      --gold: #c9973a;
      --gold-light: #e8c068;
      --gold-dim: #8a6420;
      --dark: #0d0705;
      --dark-2: #1a0f0a;
      --dark-3: #241510;
      --dark-4: #2e1c14;
      --cream: #f5e6c8;
      --cream-dim: #c4aa7a;
      --red: #8b2020;
      --green: #1a4a2e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--dark);
      color: var(--cream);
      font-family: 'Lora', serif;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Geometric background pattern */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(201,151,58,0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(201,151,58,0.06) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(139,32,32,0.04) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c9973a' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    #app {
      position: relative;
      z-index: 1;
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    header {
      text-align: center;
      padding: 28px 20px 16px;
      border-bottom: 1px solid rgba(201,151,58,0.2);
      position: relative;
    }

    .bismillah {
      font-family: 'Noto Naskh Arabic', serif;
      font-size: 1.4rem;
      color: var(--gold);
      letter-spacing: 0.05em;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    header h1 {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--gold-light), var(--gold), var(--gold-dim));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.1em;
    }

    .date-display {
      font-size: 0.75rem;
      color: var(--cream-dim);
      margin-top: 6px;
      opacity: 0.7;
    }

    /* Navigation */
    nav {
      display: flex;
      border-bottom: 1px solid rgba(201,151,58,0.15);
    }

    nav button {
      flex: 1;
      background: none;
      border: none;
      color: var(--cream-dim);
      font-family: 'Lora', serif;
      font-size: 0.8rem;
      padding: 10px 4px;
      cursor: pointer;
      transition: all 0.3s;
      border-bottom: 2px solid transparent;
      letter-spacing: 0.05em;
    }

    nav button.active {
      color: var(--gold-light);
      border-bottom-color: var(--gold);
    }

    nav button:hover:not(.active) {
      color: var(--cream);
    }

    /* Pages */
    .page { display: none; flex: 1; flex-direction: column; animation: fadeIn 0.3s ease; }
    .page.active { display: flex; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* === Zƒ∞Kƒ∞R SAYFASI === */
    #page-zikir {
      align-items: center;
      padding: 20px 16px;
      gap: 16px;
    }

    .zikir-selector {
      width: 100%;
    }

    .zikir-selector select {
      width: 100%;
      background: var(--dark-3);
      border: 1px solid rgba(201,151,58,0.3);
      color: var(--cream);
      font-family: 'Lora', serif;
      font-size: 0.9rem;
      padding: 10px 14px;
      border-radius: 8px;
      appearance: none;
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23c9973a' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    .zikir-selector select:focus { outline: none; border-color: var(--gold); }

    .arabic-display {
      text-align: center;
      padding: 20px;
      background: var(--dark-3);
      border: 1px solid rgba(201,151,58,0.2);
      border-radius: 12px;
      width: 100%;
    }

    .arabic-text {
      font-family: 'Noto Naskh Arabic', serif;
      font-size: 1.8rem;
      color: var(--gold-light);
      line-height: 1.6;
      direction: rtl;
      margin-bottom: 8px;
    }

    .transliteration {
      font-style: italic;
      font-size: 0.85rem;
      color: var(--cream-dim);
      margin-bottom: 4px;
    }

    .meaning {
      font-size: 0.78rem;
      color: var(--cream-dim);
      opacity: 0.7;
    }

    /* Counter circle */
    .counter-wrap {
      position: relative;
      width: 200px;
      height: 200px;
      flex-shrink: 0;
    }

    .counter-svg {
      position: absolute;
      inset: 0;
      transform: rotate(-90deg);
    }

    .counter-track {
      fill: none;
      stroke: rgba(201,151,58,0.1);
      stroke-width: 4;
    }

    .counter-progress {
      fill: none;
      stroke: var(--gold);
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.3s ease;
      filter: drop-shadow(0 0 6px rgba(201,151,58,0.5));
    }

    .counter-inner {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .counter-number {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 3rem;
      color: var(--gold-light);
      line-height: 1;
      transition: transform 0.1s;
    }

    .counter-number.tap {
      transform: scale(0.9);
    }

    .counter-target {
      font-size: 0.7rem;
      color: var(--cream-dim);
      margin-top: 4px;
    }

    .counter-inner::before {
      content: '';
      position: absolute;
      inset: 10px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(201,151,58,0.05) 0%, transparent 70%);
      transition: background 0.2s;
    }

    .counter-inner:active::before {
      background: radial-gradient(circle, rgba(201,151,58,0.15) 0%, transparent 70%);
    }

    .tap-hint {
      font-size: 0.72rem;
      color: var(--gold-dim);
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 10px;
      width: 100%;
    }

    .btn {
      flex: 1;
      padding: 12px;
      border: 1px solid rgba(201,151,58,0.3);
      border-radius: 8px;
      background: var(--dark-3);
      color: var(--cream-dim);
      font-family: 'Lora', serif;
      font-size: 0.82rem;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.05em;
    }

    .btn:hover {
      border-color: var(--gold);
      color: var(--gold-light);
      background: var(--dark-4);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--gold-dim), rgba(201,151,58,0.6));
      border-color: var(--gold);
      color: var(--cream);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      color: var(--dark);
    }

    /* Sets display */
    .sets-display {
      display: flex;
      gap: 8px;
      align-items: center;
      font-size: 0.8rem;
      color: var(--cream-dim);
    }

    .set-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(201,151,58,0.3);
      transition: background 0.3s;
    }

    .set-dot.done {
      background: var(--gold);
      box-shadow: 0 0 6px rgba(201,151,58,0.5);
    }

    /* Completion overlay */
    .completion-flash {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle, rgba(201,151,58,0.2) 0%, transparent 70%);
      pointer-events: none;
      opacity: 0;
      z-index: 100;
      transition: opacity 0.5s;
    }

    .completion-flash.show {
      opacity: 1;
      animation: flash 1s ease-out forwards;
    }

    @keyframes flash {
      0% { opacity: 0; }
      30% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* === ƒ∞STATƒ∞STƒ∞K === */
    #page-istatistik {
      padding: 20px 16px;
      gap: 16px;
      overflow-y: auto;
    }

    .section-title {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 0.75rem;
      color: var(--gold-dim);
      letter-spacing: 0.2em;
      text-transform: uppercase;
      margin-bottom: 2px;
    }

    .stat-card {
      background: var(--dark-3);
      border: 1px solid rgba(201,151,58,0.15);
      border-radius: 10px;
      padding: 14px 16px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .stat-item {
      text-align: center;
      padding: 10px;
      background: var(--dark-4);
      border-radius: 8px;
    }

    .stat-value {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1.4rem;
      color: var(--gold-light);
    }

    .stat-label {
      font-size: 0.7rem;
      color: var(--cream-dim);
      margin-top: 2px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: var(--dark-4);
      border-radius: 8px;
      border-left: 3px solid var(--gold-dim);
    }

    .history-zikir {
      font-size: 0.85rem;
      color: var(--cream);
    }

    .history-detail {
      font-size: 0.72rem;
      color: var(--cream-dim);
    }

    .history-count {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 1rem;
      color: var(--gold);
    }

    .empty-state {
      text-align: center;
      color: var(--cream-dim);
      font-size: 0.85rem;
      padding: 30px;
      opacity: 0.6;
    }

    /* === AYARLAR === */
    #page-ayarlar {
      padding: 20px 16px;
      gap: 16px;
      overflow-y: auto;
    }

    .setting-group {
      background: var(--dark-3);
      border: 1px solid rgba(201,151,58,0.15);
      border-radius: 10px;
      overflow: hidden;
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(201,151,58,0.08);
    }

    .setting-row:last-child { border-bottom: none; }

    .setting-label {
      font-size: 0.88rem;
      color: var(--cream);
    }

    .setting-desc {
      font-size: 0.72rem;
      color: var(--cream-dim);
      margin-top: 2px;
    }

    /* Toggle */
    .toggle {
      position: relative;
      width: 44px;
      height: 24px;
      flex-shrink: 0;
    }

    .toggle input { opacity: 0; width: 0; height: 0; }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: rgba(201,151,58,0.2);
      border-radius: 12px;
      cursor: pointer;
      transition: 0.3s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      left: 3px;
      top: 3px;
      background: var(--cream-dim);
      border-radius: 50%;
      transition: 0.3s;
    }

    .toggle input:checked + .toggle-slider {
      background: rgba(201,151,58,0.6);
    }

    .toggle input:checked + .toggle-slider::before {
      transform: translateX(20px);
      background: var(--gold-light);
    }

    /* Number input */
    .num-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .num-btn {
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: 1px solid rgba(201,151,58,0.3);
      background: var(--dark-4);
      color: var(--gold);
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .num-btn:hover {
      border-color: var(--gold);
      background: rgba(201,151,58,0.1);
    }

    .num-val {
      font-family: 'Cinzel Decorative', cursive;
      font-size: 0.9rem;
      color: var(--gold-light);
      min-width: 30px;
      text-align: center;
    }

    /* Custom zikir section */
    .custom-form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 14px 16px;
    }

    .input-field {
      width: 100%;
      background: var(--dark-4);
      border: 1px solid rgba(201,151,58,0.2);
      color: var(--cream);
      font-family: 'Lora', serif;
      font-size: 0.88rem;
      padding: 10px 12px;
      border-radius: 8px;
      transition: border-color 0.2s;
    }

    .input-field:focus { outline: none; border-color: var(--gold); }
    .input-field::placeholder { color: rgba(196,170,122,0.4); }

    .pwa-hint {
      background: linear-gradient(135deg, var(--dark-3), var(--dark-4));
      border: 1px solid rgba(201,151,58,0.25);
      border-radius: 10px;
      padding: 16px;
      font-size: 0.82rem;
      color: var(--cream-dim);
      line-height: 1.6;
    }

    .pwa-hint strong {
      color: var(--gold);
      display: block;
      margin-bottom: 8px;
      font-family: 'Cinzel Decorative', cursive;
      font-size: 0.75rem;
      letter-spacing: 0.1em;
    }

    .pwa-hint ul {
      padding-left: 16px;
    }

    .pwa-hint li {
      margin-bottom: 4px;
    }

    /* Ornament */
    .ornament {
      text-align: center;
      color: var(--gold-dim);
      font-size: 1.2rem;
      opacity: 0.5;
      letter-spacing: 0.5em;
    }

    /* Ripple effect on tap */
    @keyframes ripple {
      from { transform: scale(0.8); opacity: 0.6; }
      to { transform: scale(1.2); opacity: 0; }
    }

    .ripple {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 2px solid var(--gold);
      animation: ripple 0.6s ease-out forwards;
      pointer-events: none;
    }

    /* Vibration feedback visual */
    @keyframes pulse-gold {
      0% { box-shadow: 0 0 0 0 rgba(201,151,58,0.4); }
      70% { box-shadow: 0 0 0 15px rgba(201,151,58,0); }
      100% { box-shadow: 0 0 0 0 rgba(201,151,58,0); }
    }

    .scrollable { overflow-y: auto; }
  </style>
</head>
<body>
  <div id="app">
    <div class="completion-flash" id="completionFlash"></div>

    <header>
      <div class="bismillah">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</div>
      <h1>Zikir</h1>
      <div class="date-display" id="dateDisplay"></div>
    </header>

    <nav>
      <button class="active" onclick="showPage('zikir', this)">Tesbihat</button>
      <button onclick="showPage('istatistik', this)">ƒ∞statistik</button>
      <button onclick="showPage('ayarlar', this)">Ayarlar</button>
    </nav>

    <!-- Zƒ∞Kƒ∞R SAYFASI -->
    <div class="page active" id="page-zikir">
      <div class="zikir-selector">
        <select id="zikirSelect" onchange="changeZikir()"></select>
      </div>

      <div class="arabic-display">
        <div class="arabic-text" id="arabicText"></div>
        <div class="transliteration" id="translitText"></div>
        <div class="meaning" id="meaningText"></div>
      </div>

      <div class="counter-wrap" id="counterWrap" onclick="handleTap()">
        <svg class="counter-svg" viewBox="0 0 200 200">
          <circle class="counter-track" cx="100" cy="100" r="90"/>
          <circle class="counter-progress" id="progressCircle" cx="100" cy="100" r="90"
            stroke-dasharray="565.5"
            stroke-dashoffset="565.5"/>
        </svg>
        <div class="counter-inner">
          <div class="counter-number" id="counterNum">0</div>
          <div class="counter-target" id="counterTarget">/ 33</div>
        </div>
      </div>

      <div class="tap-hint">Dokunarak say</div>

      <div class="sets-display" id="setsDisplay"></div>

      <div class="controls">
        <button class="btn" onclick="undoTap()">‚Ü© Geri Al</button>
        <button class="btn" onclick="resetCounter()">Sƒ±fƒ±rla</button>
        <button class="btn btn-primary" onclick="saveSession()">‚úì Kaydet</button>
      </div>
    </div>

    <!-- ƒ∞STATƒ∞STƒ∞K SAYFASI -->
    <div class="page" id="page-istatistik">
      <div class="section-title">Bug√ºnk√º √ñzet</div>
      <div class="stat-card">
        <div class="stat-grid" id="statGrid"></div>
      </div>

      <div class="section-title">Ge√ßmi≈ü Kayƒ±tlar</div>
      <div class="history-list" id="historyList"></div>
    </div>

    <!-- AYARLAR SAYFASI -->
    <div class="page" id="page-ayarlar">
      <div class="section-title">Saya√ß Ayarlarƒ±</div>
      <div class="setting-group">
        <div class="setting-row">
          <div>
            <div class="setting-label">Hedef Sayƒ±</div>
            <div class="setting-desc">Her tur i√ßin sayƒ±m hedefi</div>
          </div>
          <div class="num-input">
            <button class="num-btn" onclick="changeTarget(-1)">‚àí</button>
            <div class="num-val" id="targetDisplay">33</div>
            <button class="num-btn" onclick="changeTarget(1)">+</button>
          </div>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Titre≈üim</div>
            <div class="setting-desc">Her dokunu≈üta titre≈üim</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="vibToggle" checked onchange="saveSetting('vibration', this.checked)"/>
            <div class="toggle-slider"></div>
          </label>
        </div>
        <div class="setting-row">
          <div>
            <div class="setting-label">Tamamlanma Sesi</div>
            <div class="setting-desc">Tur tamamlandƒ±ƒüƒ±nda ses</div>
          </div>
          <label class="toggle">
            <input type="checkbox" id="soundToggle" checked onchange="saveSetting('sound', this.checked)"/>
            <div class="toggle-slider"></div>
          </label>
        </div>
      </div>

      <div class="section-title">√ñzel Zikir Ekle</div>
      <div class="setting-group">
        <div class="custom-form">
          <input class="input-field" id="customArabic" placeholder="Arap√ßa metin (isteƒüe baƒülƒ±)" dir="rtl"/>
          <input class="input-field" id="customName" placeholder="Zikir adƒ± (√∂rn: Allahu Ekber)"/>
          <input class="input-field" id="customTranslit" placeholder="Okunu≈ü"/>
          <input class="input-field" id="customMeaning" placeholder="Anlamƒ±"/>
          <button class="btn btn-primary" onclick="addCustomZikir()">+ Zikir Ekle</button>
        </div>
      </div>

      <div class="section-title">Masa√ºst√ºne / Telefona Kaydet</div>
      <div class="pwa-hint">
        <strong>üì± Ana Ekrana Ekle</strong>
        <ul>
          <li><strong>iPhone/iPad:</strong> Safari'de a√ß ‚Üí Payla≈ü ‚Üí "Ana Ekrana Ekle"</li>
          <li><strong>Android:</strong> Chrome'da a√ß ‚Üí Men√º (‚ãÆ) ‚Üí "Ana ekrana ekle"</li>
          <li><strong>Masa√ºst√º:</strong> Chrome/Edge adres √ßubuƒüundaki ‚äï simgesine tƒ±kla</li>
        </ul>
      </div>

      <div class="section-title">Tehlikeli B√∂lge</div>
      <div class="setting-group">
        <div class="setting-row">
          <div>
            <div class="setting-label" style="color:#e07070">T√ºm Verileri Sil</div>
            <div class="setting-desc">Ge√ßmi≈ü kayƒ±tlar silinir</div>
          </div>
          <button class="btn" style="flex:0;color:#e07070;border-color:#8b2020" onclick="clearAllData()">Sil</button>
        </div>
      </div>

      <div class="ornament">‚ú¶ ‚ú¶ ‚ú¶</div>
    </div>
  </div>

  <script>
    // ==================== VERƒ∞ ====================
    const DEFAULT_ZIKIRLER = [
      { id: 'subhanallah', name: 'S√ºbhanallah', arabic: 'ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé ÿßŸÑŸÑŸáŸê', translit: 'S√ºbh√¢nall√¢h', meaning: 'Allah\'ƒ± t√ºm noksanlƒ±klardan tenzih ederim' },
      { id: 'elhamdulillah', name: 'Elhamd√ºlillah', arabic: 'ÿßŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸÑŸáŸê', translit: 'Elhamd√ºlill√¢h', meaning: 'Hamd Allah\'a mahsustur' },
      { id: 'allahuekber', name: 'Allahu Ekber', arabic: 'ÿßŸÑŸÑŸáŸè ÿ£ŸéŸÉŸíÿ®Ÿéÿ±Ÿè', translit: 'All√¢hu Ekber', meaning: 'Allah en b√ºy√ºkt√ºr' },
      { id: 'laileha', name: 'L√¢ il√¢he illallah', arabic: 'ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸáŸè', translit: 'L√¢ il√¢he illall√¢h', meaning: 'Allah\'tan ba≈üka ilah yoktur' },
      { id: 'salavat', name: 'Salavat', arabic: 'ÿßŸéŸÑŸÑŸëŸ∞ŸáŸèŸÖŸéŸë ÿµŸéŸÑŸêŸë ÿπŸéŸÑŸ∞Ÿâ ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸç', translit: 'All√¢h√ºmme salli al√¢ Muhammed', meaning: 'Allah\'ƒ±m, Muhammed\'e salat et' },
      { id: 'istigfar', name: 'ƒ∞stiƒüfar', arabic: 'ÿ£Ÿéÿ≥Ÿíÿ™Ÿéÿ∫ŸíŸÅŸêÿ±Ÿè ÿßŸÑŸÑŸáŸé', translit: 'Estaƒüfirull√¢h', meaning: 'Allah\'tan baƒüƒ±≈ülanma dilerim' },
      { id: 'hasbiyallah', name: 'Hasbiyallah', arabic: 'ÿ≠Ÿéÿ≥Ÿíÿ®ŸêŸäŸé ÿßŸÑŸÑŸáŸè ŸàŸéŸÜŸêÿπŸíŸÖŸé ÿßŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè', translit: 'Hasbiyall√¢hu ve ni\'mel vek√Æl', meaning: 'Allah bana yeter, O ne g√ºzel vekildir' },
      { id: 'subhane', name: 'Tesbih Tesbihi', arabic: 'ÿ≥Ÿèÿ®Ÿíÿ≠ŸéÿßŸÜŸé ÿßŸÑŸÑŸáŸê ŸàŸéÿ®Ÿêÿ≠ŸéŸÖŸíÿØŸêŸáŸê', translit: 'S√ºbh√¢nall√¢hi ve bi hamdih√Æ', meaning: 'Allah\'ƒ± hamdederek tenzih ederim' },
    ];

    // ==================== STATE ====================
    let state = {
      count: 0,
      sets: 0,
      currentZikirId: 'subhanallah',
      target: 33,
      vibration: true,
      sound: true,
      zikirler: [],
      history: []
    };

    function loadState() {
      try {
        const saved = localStorage.getItem('zikir_app_v2');
        if (saved) {
          const parsed = JSON.parse(saved);
          state = { ...state, ...parsed };
        }
      } catch(e) {}
      // Merge default zikirler
      const customIds = state.zikirler.map(z => z.id);
      state.zikirler = [
        ...DEFAULT_ZIKIRLER,
        ...state.zikirler.filter(z => !DEFAULT_ZIKIRLER.find(d => d.id === z.id))
      ];
    }

    function saveState() {
      try {
        // Only save custom zikirler + settings
        const toSave = {
          currentZikirId: state.currentZikirId,
          target: state.target,
          vibration: state.vibration,
          sound: state.sound,
          zikirler: state.zikirler.filter(z => !DEFAULT_ZIKIRLER.find(d => d.id === z.id)),
          history: state.history.slice(0, 100) // max 100 kayƒ±t
        };
        localStorage.setItem('zikir_app_v2', JSON.stringify(toSave));
      } catch(e) {}
    }

    // ==================== UI ====================
    function showPage(name, btn) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
      document.getElementById('page-' + name).classList.add('active');
      btn.classList.add('active');
      if (name === 'istatistik') renderStats();
    }

    function setDateDisplay() {
      const d = new Date();
      const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('dateDisplay').textContent = d.toLocaleDateString('tr-TR', opts);
    }

    function populateZikirSelect() {
      const sel = document.getElementById('zikirSelect');
      sel.innerHTML = '';
      state.zikirler.forEach(z => {
        const opt = document.createElement('option');
        opt.value = z.id;
        opt.textContent = z.name;
        if (z.id === state.currentZikirId) opt.selected = true;
        sel.appendChild(opt);
      });
    }

    function getCurrentZikir() {
      return state.zikirler.find(z => z.id === state.currentZikirId) || state.zikirler[0];
    }

    function updateArabicDisplay() {
      const z = getCurrentZikir();
      document.getElementById('arabicText').textContent = z.arabic || '';
      document.getElementById('translitText').textContent = z.translit || '';
      document.getElementById('meaningText').textContent = z.meaning || '';
    }

    function updateCounterUI() {
      const num = document.getElementById('counterNum');
      num.textContent = state.count;
      document.getElementById('counterTarget').textContent = '/ ' + state.target;

      // Progress circle
      const circumference = 565.5;
      const progress = Math.min(state.count / state.target, 1);
      const offset = circumference * (1 - progress);
      document.getElementById('progressCircle').style.strokeDashoffset = offset;

      // Sets dots
      const setsDiv = document.getElementById('setsDisplay');
      setsDiv.innerHTML = '';
      if (state.sets > 0) {
        const label = document.createElement('span');
        label.textContent = 'Turlar:';
        label.style.fontSize = '0.75rem';
        label.style.color = 'var(--cream-dim)';
        setsDiv.appendChild(label);
        for (let i = 0; i < Math.min(state.sets, 10); i++) {
          const dot = document.createElement('div');
          dot.className = 'set-dot done';
          setsDiv.appendChild(dot);
        }
        if (state.sets > 10) {
          const more = document.createElement('span');
          more.textContent = '+' + (state.sets - 10);
          more.style.fontSize = '0.7rem';
          more.style.color = 'var(--gold-dim)';
          setsDiv.appendChild(more);
        }
      }
    }

    // ==================== ACTIONS ====================
    function handleTap() {
      state.count++;

      // Tap animation
      const num = document.getElementById('counterNum');
      num.classList.add('tap');
      setTimeout(() => num.classList.remove('tap'), 100);

      // Ripple
      const wrap = document.getElementById('counterWrap');
      const ripple = document.createElement('div');
      ripple.className = 'ripple';
      wrap.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);

      // Vibration
      if (state.vibration && navigator.vibrate) navigator.vibrate(30);

      // Check completion
      if (state.count >= state.target) {
        state.sets++;
        state.count = 0;
        onSetComplete();
      }

      updateCounterUI();
      saveState();
    }

    function onSetComplete() {
      // Flash
      const flash = document.getElementById('completionFlash');
      flash.classList.add('show');
      setTimeout(() => flash.classList.remove('show'), 1000);

      // Sound
      if (state.sound) playBeep();

      // Vibrate pattern
      if (state.vibration && navigator.vibrate) navigator.vibrate([100, 50, 100]);
    }

    function playBeep() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.type = 'sine';
        osc.frequency.value = 528;
        gain.gain.setValueAtTime(0.3, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.8);
      } catch(e) {}
    }

    function undoTap() {
      if (state.count > 0) {
        state.count--;
        updateCounterUI();
        saveState();
      } else if (state.sets > 0) {
        state.sets--;
        state.count = state.target - 1;
        updateCounterUI();
        saveState();
      }
    }

    function resetCounter() {
      if (state.count === 0 && state.sets === 0) return;
      if (confirm('Sayacƒ± sƒ±fƒ±rlamak istiyor musunuz?')) {
        state.count = 0;
        state.sets = 0;
        updateCounterUI();
        saveState();
      }
    }

    function saveSession() {
      const z = getCurrentZikir();
      const total = state.sets * state.target + state.count;
      if (total === 0) { alert('Hen√ºz sayƒ±m yapƒ±lmadƒ±.'); return; }

      const record = {
        id: Date.now(),
        zikirName: z.name,
        sets: state.sets,
        extra: state.count,
        total: total,
        date: new Date().toLocaleDateString('tr-TR'),
        time: new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })
      };

      state.history.unshift(record);
      state.count = 0;
      state.sets = 0;
      updateCounterUI();
      saveState();
      alert(`‚úì Kaydedildi\n${z.name}: ${total} kez`);
    }

    function changeZikir() {
      state.currentZikirId = document.getElementById('zikirSelect').value;
      state.count = 0;
      state.sets = 0;
      updateArabicDisplay();
      updateCounterUI();
      saveState();
    }

    // ==================== SETTINGS ====================
    function changeTarget(delta) {
      state.target = Math.max(1, Math.min(999, state.target + delta));
      document.getElementById('targetDisplay').textContent = state.target;
      updateCounterUI();
      saveState();
    }

    function saveSetting(key, value) {
      state[key] = value;
      saveState();
    }

    function addCustomZikir() {
      const arabic = document.getElementById('customArabic').value.trim();
      const name = document.getElementById('customName').value.trim();
      const translit = document.getElementById('customTranslit').value.trim();
      const meaning = document.getElementById('customMeaning').value.trim();

      if (!name) { alert('Zikir adƒ± gereklidir.'); return; }

      const custom = {
        id: 'custom_' + Date.now(),
        name, arabic, translit, meaning
      };

      state.zikirler.push(custom);
      populateZikirSelect();
      saveState();

      document.getElementById('customArabic').value = '';
      document.getElementById('customName').value = '';
      document.getElementById('customTranslit').value = '';
      document.getElementById('customMeaning').value = '';
      alert(`"${name}" eklendi.`);
    }

    function clearAllData() {
      if (confirm('T√ºm ge√ßmi≈ü kayƒ±tlar silinecek. Emin misiniz?')) {
        state.history = [];
        saveState();
        alert('Veriler silindi.');
      }
    }

    // ==================== STATS ====================
    function renderStats() {
      const today = new Date().toLocaleDateString('tr-TR');
      const todayRecords = state.history.filter(h => h.date === today);
      const todayTotal = todayRecords.reduce((s, h) => s + h.total, 0);
      const allTotal = state.history.reduce((s, h) => s + h.total, 0);
      const days = new Set(state.history.map(h => h.date)).size;

      const grid = document.getElementById('statGrid');
      grid.innerHTML = `
        <div class="stat-item">
          <div class="stat-value">${todayTotal}</div>
          <div class="stat-label">Bug√ºn</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${todayRecords.length}</div>
          <div class="stat-label">Bug√ºn Seans</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${allTotal.toLocaleString('tr-TR')}</div>
          <div class="stat-label">Toplam</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${days}</div>
          <div class="stat-label">Aktif G√ºn</div>
        </div>
      `;

      const list = document.getElementById('historyList');
      if (state.history.length === 0) {
        list.innerHTML = '<div class="empty-state">Hen√ºz kayƒ±t yok.<br/>Zikir √ßekip "Kaydet" butonuna basƒ±n.</div>';
        return;
      }

      list.innerHTML = state.history.slice(0, 30).map(h => `
        <div class="history-item">
          <div>
            <div class="history-zikir">${h.zikirName}</div>
            <div class="history-detail">${h.date} ${h.time} ¬∑ ${h.sets} tur${h.extra > 0 ? ' + ' + h.extra : ''}</div>
          </div>
          <div class="history-count">${h.total}</div>
        </div>
      `).join('');
    }

    // ==================== INIT ====================
    function init() {
      loadState();
      setDateDisplay();
      populateZikirSelect();
      updateArabicDisplay();
      updateCounterUI();

      // Restore settings UI
      document.getElementById('targetDisplay').textContent = state.target;
      document.getElementById('vibToggle').checked = state.vibration;
      document.getElementById('soundToggle').checked = state.sound;
    }

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' || e.code === 'Enter') {
        const activePage = document.querySelector('.page.active');
        if (activePage && activePage.id === 'page-zikir') {
          e.preventDefault();
          handleTap();
        }
      }
    });

    init();
  </script>
</body>
</html>
